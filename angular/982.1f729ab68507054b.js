"use strict";(self.webpackChunkmean=self.webpackChunkmean||[]).push([[982],{3982:(ot,x,c)=>{c.r(x),c.d(x,{PostsModule:()=>X});var n=c(2382),g=c(9808),d=c(3673),A=c(4786),t=c(5e3),v=c(7579),b=c(9646),Z=c(8306);const F=s=>{if("string"==typeof s.value)return(0,b.of)(null);const a=s.value,e=new FileReader;return Z.y.create(i=>{e.addEventListener("loadend",()=>{const p=new Uint8Array(e.result).subarray(0,4);let r="",l=!1;for(let u=0;u<p.length;u++)r+=p[u].toString(16);switch(r){case"89504e47":case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":l=!0;break;default:l=!1}i.next(l?null:{invalidMimeType:!0}),i.complete()}),e.readAsArrayBuffer(a)})};var L=c(4004),T=c(2340),_=c(520);const m=T.N.apiUrl+"/posts/";let C=(()=>{class s{constructor(e,o){this.httpClient=e,this.router=o,this.posts=[],this.postsUpdated=new v.x}getAllData(){return this.httpClient.get(m)}getPosts(e,o){this.httpClient.get(m+`?pagesize=${e}&page=${o}`).pipe((0,L.U)(p=>({posts:p.posts.map(r=>({title:r.title,content:r.content,id:r._id,imagePath:r.imagePath,creator:r.creator})),maxPosts:p.maxPosts}))).subscribe(p=>{this.posts=p.posts,console.log(this.posts),this.postsUpdated.next({posts:[...this.posts],postCount:p.maxPosts})})}getPost(e){return this.httpClient.get(m+e)}getPostUpdateListener(){return this.postsUpdated.asObservable()}postData(e,o,i){const p=new FormData;p.append("title",e),p.append("content",o),p.append("image",i),this.httpClient.post(m,p).subscribe(r=>{this.posts.push({id:r.post.id,title:r.post.title,content:r.post.content,imagePath:r.post.imagePath,creator:null}),this.postsUpdated.next({posts:[...this.posts],postCount:0}),this.router.navigate(["/"])})}deletePost(e){this.httpClient.delete(m+e).subscribe(()=>{const o=this.posts.filter(i=>i.id!==e);this.posts=o,this.postsUpdated.next({posts:[...this.posts],postCount:0})})}updatePost(e,o,i,p){const r=new FormData;r.append("id",e),r.append("title",o),r.append("content",i),r.append("imagePath",p),console.log(r),this.httpClient.put(m+e,r).subscribe(l=>{const u=[...this.posts],tt=u.findIndex(st=>st.id===e);u[tt]={id:e,title:o,content:i,imagePath:"",creator:null},this.posts=u,this.postsUpdated.next({posts:[...this.posts],postCount:0}),this.router.navigate(["/"])})}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(_.eN),t.LFG(d.F0))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var S=c(384),U=c(9224),h=c(7322),y=c(7531),I=c(7423);function w(s,a){1&s&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter title"),t.qZA())}function O(s,a){1&s&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter content"),t.qZA())}function N(s,a){if(1&s&&(t.TgZ(0,"div",10),t._UZ(1,"img",11),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("src",e.imagePreview,t.LSH)("alt",e.postForm.value.title)}}let J=(()=>{class s{constructor(e,o,i){this.postService=e,this.httpClient=o,this.authService=i,this.newPost="mean-course",this.post2="",this.postInput1="",this.postInput2="",this.isLoading=!0,this.postsPerPage=2,this.currentPage=1,this.post=[],this.PostInputData=[],this.postsUpdated=new v.x,this.inputData=new t.vpe}ngOnInit(){this.authStatusSub=this.authService.getAuthStatusListener().subscribe(e=>{this.isLoading=!1}),this.postForm=new n.cw({title:new n.NI(null,{validators:[n.kI.required,n.kI.minLength(3)]}),content:new n.NI(null,{validators:[n.kI.required]}),image:new n.NI(null,{validators:[n.kI.required],asyncValidators:[F]})})}onSubmit(){this.postForm.invalid||(this.postService.postData(this.postForm.value.title,this.postForm.value.content,this.postForm.value.image),this.postForm.reset())}onImagePicked(e){const o=e.target.files[0];this.postForm.patchValue({image:o}),this.postForm.get("image").updateValueAndValidity();const i=new FileReader;i.onload=()=>{this.imagePreview=i.result},i.readAsDataURL(o)}ngOnDestroy(){this.authStatusSub.unsubscribe()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(C),t.Y36(_.eN),t.Y36(S.J))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-post-create"]],outputs:{inputData:"inputData"},decls:18,vars:4,consts:[[3,"formGroup","submit"],["type","text","formControlName","title","matInput","","placeholder","Enter title"],[4,"ngIf"],["type","text","formControlName","content","matInput","","placeholder","Enter content"],["id","imageUpload"],["mat-stroked-button","","type","submit",3,"click"],["type","file",3,"change"],["filePicker",""],["class","image-preview",4,"ngIf"],["mat-raised-button","","color","primary","type","submit"],[1,"image-preview"],[3,"src","alt"]],template:function(e,o){if(1&e){const i=t.EpF();t.TgZ(0,"mat-card")(1,"form",0),t.NdJ("submit",function(){return o.onSubmit()}),t.TgZ(2,"mat-form-field"),t._UZ(3,"input",1),t.YNc(4,w,2,0,"mat-error",2),t.qZA(),t.TgZ(5,"mat-form-field"),t._UZ(6,"input",3),t.YNc(7,O,2,0,"mat-error",2),t.qZA(),t.TgZ(8,"div",4)(9,"p"),t._uU(10,"Image Upload"),t.qZA(),t.TgZ(11,"button",5),t.NdJ("click",function(){return t.CHM(i),t.MAs(14).click()}),t._uU(12,"pickfile"),t.qZA(),t.TgZ(13,"input",6,7),t.NdJ("change",function(r){return o.onImagePicked(r)}),t.qZA()(),t.YNc(15,N,2,2,"div",8),t.TgZ(16,"button",9),t._uU(17,"Save post"),t.qZA()()()}2&e&&(t.xp6(1),t.Q6J("formGroup",o.postForm),t.xp6(3),t.Q6J("ngIf",o.postForm.get("title").invalid),t.xp6(3),t.Q6J("ngIf",o.postForm.get("content").invalid),t.xp6(8),t.Q6J("ngIf",""!==o.imagePreview&&o.imagePreview&&o.postForm.get("image").valid))},directives:[U.a8,n._Y,n.JL,n.sg,h.KE,n.Fj,y.Nt,n.JJ,n.u,g.O5,h.TO,I.lW],styles:["mat-card[_ngcontent-%COMP%]{width:80%;margin:auto}mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}input[type=file][_ngcontent-%COMP%]{visibility:hidden}#imageUpload[_ngcontent-%COMP%]{padding-right:20px}#imageUpload[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:tomato}"]}),s})();const M=s=>{if("string"==typeof s.value)return(0,b.of)(null);const a=s.value,e=new FileReader;return Z.y.create(i=>{e.addEventListener("loadend",()=>{const p=new Uint8Array(e.result).subarray(0,4);let r="",l=!1;for(let u=0;u<p.length;u++)r+=p[u].toString(16);switch(r){case"89504e47":case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":l=!0;break;default:l=!1}i.next(l?null:{invalidMimeType:!0}),i.complete()}),e.readAsArrayBuffer(a)})};function E(s,a){1&s&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter title"),t.qZA())}function k(s,a){1&s&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter content"),t.qZA())}function Y(s,a){if(1&s&&(t.TgZ(0,"div",10),t._UZ(1,"img",11),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("src",e.imagePreview,t.LSH)("alt",e.postForm.value.title)}}let Q=(()=>{class s{constructor(e,o){this.postsService=e,this.route=o,this.enteredTitle="",this.enteredContent="",this.mode="create",this.isLoading=!1}ngOnInit(){this.route.paramMap.subscribe(e=>{e.has("postId")?(this.mode="edit",this.postId=e.get("postId"),this.postsService.getPost(this.postId).subscribe(o=>{this.isLoading=!1,this.post={id:o._id,title:o.title,content:o.content,imagePath:"",creator:null},console.log(this.post)})):(this.mode="create",this.postId=null)}),this.postForm=new n.cw({title:new n.NI(null,{validators:[n.kI.required,n.kI.minLength(3)]}),content:new n.NI(null,{validators:[n.kI.required]}),image:new n.NI(null,{validators:[n.kI.required],asyncValidators:[M]})})}onSavePost(){this.postForm.invalid||(this.postsService.updatePost(this.postId,this.postForm.value.title,this.postForm.value.content,this.postForm.value.image),this.postForm.reset())}onImagePicked(e){const o=e.target.files[0];this.postForm.patchValue({image:o}),this.postForm.get("image").updateValueAndValidity();const i=new FileReader;i.onload=()=>{this.imagePreview=i.result},i.readAsDataURL(o)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(C),t.Y36(d.gz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-post-edit"]],decls:20,vars:6,consts:[[3,"formGroup","submit"],["type","text","formControlName","title","matInput","","placeholder","Enter title",3,"ngModel"],[4,"ngIf"],["type","content","formControlName","content","matInput","","placeholder","Enter content",3,"ngModel"],["id","imageUpload"],["mat-stroked-button","","type","submit",3,"click"],["type","file",3,"change"],["filePicker",""],["class","image-preview",4,"ngIf"],["mat-raised-button","","color","primary","type","submit"],[1,"image-preview"],[3,"src","alt"]],template:function(e,o){if(1&e){const i=t.EpF();t.TgZ(0,"mat-card")(1,"form",0),t.NdJ("submit",function(){return o.onSavePost()}),t.TgZ(2,"mat-form-field"),t._UZ(3,"input",1),t.YNc(4,E,2,0,"mat-error",2),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"mat-form-field"),t._UZ(7,"input",3),t.YNc(8,k,2,0,"mat-error",2),t.qZA(),t._UZ(9,"br"),t.TgZ(10,"div",4)(11,"p"),t._uU(12,"Image Upload"),t.qZA(),t.TgZ(13,"button",5),t.NdJ("click",function(){return t.CHM(i),t.MAs(16).click()}),t._uU(14,"pickfile"),t.qZA(),t.TgZ(15,"input",6,7),t.NdJ("change",function(r){return o.onImagePicked(r)}),t.qZA()(),t.YNc(17,Y,2,2,"div",8),t.TgZ(18,"button",9),t._uU(19,"Save post"),t.qZA()()()}2&e&&(t.xp6(1),t.Q6J("formGroup",o.postForm),t.xp6(2),t.Q6J("ngModel",o.post.title),t.xp6(1),t.Q6J("ngIf",o.postForm.get("title").invalid),t.xp6(3),t.Q6J("ngModel",o.post.content),t.xp6(1),t.Q6J("ngIf",o.postForm.get("content").invalid),t.xp6(9),t.Q6J("ngIf",""!==o.imagePreview&&o.imagePreview))},directives:[U.a8,n._Y,n.JL,n.sg,h.KE,n.Fj,y.Nt,n.JJ,n.u,g.O5,h.TO,I.lW],styles:["input[type=file][_ngcontent-%COMP%]{visibility:hidden}#imageUpload[_ngcontent-%COMP%]{padding-right:20px}#imageUpload[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:tomato}"]}),s})();var z=c(773),f=c(1125),D=c(2426);function q(s,a){1&s&&t._UZ(0,"mat-spinner")}const R=function(s){return["/post/edit",s]};function V(s,a){if(1&s){const e=t.EpF();t.TgZ(0,"mat-action-row")(1,"button",6),t._uU(2,"EDIT"),t.qZA(),t.TgZ(3,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(2).onDelete(i.id)}),t._uU(4,"DELETE"),t.qZA()()}if(2&s){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("routerLink",t.VKq(1,R,e.id))}}function B(s,a){if(1&s&&(t.TgZ(0,"mat-accordion",3)(1,"mat-expansion-panel")(2,"mat-expansion-panel-header"),t._uU(3),t.qZA(),t.TgZ(4,"div",4),t._UZ(5,"img",5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA(),t.YNc(8,V,5,3,"mat-action-row",0),t.qZA()()),2&s){const e=a.$implicit,o=t.oxw(2);t.xp6(3),t.hij(" ",e.title," "),t.xp6(2),t.Q6J("src",e.imagePath,t.LSH)("alt",e.title),t.xp6(2),t.Oqu(e.content),t.xp6(1),t.Q6J("ngIf",(o.userIsAuthenticated||o.socialUserIsAuthenticated)&&o.userId===e.creator)}}function H(s,a){if(1&s){const e=t.EpF();t.TgZ(0,"mat-paginator",8),t.NdJ("page",function(i){return t.CHM(e),t.oxw(2).onChangedPage(i)}),t.qZA()}if(2&s){const e=t.oxw(2);t.Q6J("length",e.totalPosts)("pageSize",e.postsPerPage)("pageSizeOptions",e.pageSizeOptions)}}function G(s,a){if(1&s&&(t.TgZ(0,"div"),t.YNc(1,B,9,5,"mat-accordion",1),t.YNc(2,H,1,3,"mat-paginator",2),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.post),t.xp6(1),t.Q6J("ngIf",e.post.length>0)}}const j=T.N.apiUrl+"/posts/";let $=(()=>{class s{constructor(e,o,i){this.postService=e,this.httpClient=o,this.authService=i,this.totalPosts=0,this.postsPerPage=2,this.pageSizeOptions=[1,2,5,10],this.userIsAuthenticated=!1,this.socialUserIsAuthenticated=!1,this.currentPage=1,this.post=[],this.postsUpdated=new v.x,this.isLoading=!1,this.url="http://localhost:9000/api/posts/",this.posts1=[{title:"First post",content:"This is firt post's content"},{title:"Second post",content:"This is second post's content "},{title:"Third post",content:"This is third post's content"}],this.postList=[]}ngOnInit(){this.isLoading=!0,this.postService.getPosts(this.postsPerPage,this.currentPage),this.userId=this.authService.getUserId(),this.postsSub=this.postService.getPostUpdateListener().subscribe(e=>{this.isLoading=!1,this.totalPosts=e.postCount,this.post=e.posts}),this.userIsAuthenticated=this.authService.getIsAuth(),this.authStatusSub=this.authService.getAuthStatusListener().subscribe(e=>{this.userIsAuthenticated=e,this.userId=this.authService.getUserId()}),this.authStatusSub=this.authService.getSocialAuthStatusListener().subscribe(e=>{this.socialUserIsAuthenticated=e,this.userId=this.authService.getUserId()})}onDelete(e){this.postService.deletePost(e)}deletePost(e){this.httpClient.delete(j+e).subscribe(()=>{const o=this.posts.filter(i=>i.id!==e);this.posts=o,this.postsUpdated.next([...this.posts])})}ngOnDestroy(){this.postsSub.unsubscribe()}onChangedPage(e){this.isLoading=!0,this.currentPage=e.pageIndex+1,this.postsPerPage=e.pageSize,this.postService.getPosts(this.postsPerPage,this.currentPage)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(C),t.Y36(_.eN),t.Y36(S.J))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-post-list"]],inputs:{posts:"posts"},decls:2,vars:2,consts:[[4,"ngIf"],["multi","true",4,"ngFor","ngForOf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["multi","true"],[1,"post-image"],[3,"src","alt"],["mat-button","","color","primary",3,"routerLink"],["mat-button","","color","warn",3,"click"],[3,"length","pageSize","pageSizeOptions","page"]],template:function(e,o){1&e&&(t.YNc(0,q,1,0,"mat-spinner",0),t.YNc(1,G,3,2,"div",0)),2&e&&(t.Q6J("ngIf",o.isLoading),t.xp6(1),t.Q6J("ngIf",o.post.length>0&&!o.isLoading))},directives:[g.O5,z.$g,g.sg,f.pp,f.ib,f.yz,f.VG,I.lW,d.rH,D.NW],styles:["[_nghost-%COMP%]{display:block;margin-top:auto}mat-body-1[_ngcontent-%COMP%]{-webkit-text-decoration:center;text-decoration:center}mat-spinner[_ngcontent-%COMP%]{margin:auto}.info-text[_ngcontent-%COMP%]{text-align:center}.post-image[_ngcontent-%COMP%]{width:50%;height:500px}.post-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;box-shadow:1px 1px 5px #00000080}"]}),s})();var P=c(3506);const K=[{path:"create",component:J,canActivate:[P.a]},{path:"edit/:postId",component:Q,canActivate:[P.a]},{path:"list",component:$,canActivate:[P.a]}];let W=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({providers:[P.a],imports:[[d.Bz.forChild(K)],d.Bz]}),s})(),X=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[g.ez,n.u5,n.UX,A.h,d.Bz,W]]}),s})()}}]);